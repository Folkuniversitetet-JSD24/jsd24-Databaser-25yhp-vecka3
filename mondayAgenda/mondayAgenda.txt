ğŸ§¾ Lektionsplanering â€“ MÃ¥ndag 27 maj 2025
â° Tid: 13.00â€“16.00
ğŸ¯ Fokus: Mongoose-schema, modeller, en-till-mÃ¥nga-relationer
ğŸ§  Pedagogiskt fokus: gÃ¥ frÃ¥n MongoDB GUI till strukturerad kodbas, fÃ¶rstÃ¥ skillnaden mellan schemalÃ¶s och schema-driven datamodellering, praktiskt bygga modeller och skapa relationer

-----------------------------
ğŸ¯ Syfte

FÃ¶rstÃ¥ varfÃ¶r vi anvÃ¤nder Mongoose nÃ¤r vi jobbar med MongoDB i Node.js

FÃ¶rstÃ¥ hur Mongoose anvÃ¤nder scheman fÃ¶r att strukturera data i MongoDB

Kunna skapa modeller i Node.js med Mongoose

Skapa en-till-mÃ¥nga-relationer med ref och populate()

FÃ¶rbereda infÃ¶r ett komplett REST-API-byggande i lektion 3

-----------------------------
ğŸ§  Agenda

ğŸ‘‹ Teori: Vad Ã¤r Mongoose? VarfÃ¶r anvÃ¤nda schema? FÃ¶rdelar/nackdelar?
ğŸ’» Code-Along 1	Skapa projekt, skapa schema, model, ref och relationsstruktur, ansluta till MongoDB Atlas
ğŸ’» Code-Along 2	Bygg routes fÃ¶r POST och GET med populate()
ğŸ§‘â€ğŸ’» SjÃ¤lvstÃ¤ndig Ã¶vningar
ğŸ” Reflektion & frÃ¥gor	Hur kÃ¤nns Mongoose jÃ¤mfÃ¶rt med Atlas GUI? NÃ¤r Ã¤r schema-struktur viktigt? NÃ¤r passar ref bÃ¤ttre Ã¤n inbÃ¤ddning? Vad kÃ¤nns oklart?

-----------------------------
-----------------------------
-----------------------------
ğŸ§  TEORI

Vi har tidigare jobbat direkt i MongoDB Atlas â€“ idag ska vi bÃ¶rja strukturera vÃ¥r data med hjÃ¤lp av Mongoose

ğŸ—£ï¸ Vad Ã¤r Mongoose?

MongoDB i sig Ã¤r schemalÃ¶st. Vi kan slÃ¤nga in vad som helst â€“ vilket ger oss frihet, men ocksÃ¥ risk fÃ¶r kaos.

Mongoose tvingar oss att definiera struktur - ett schema. VarfÃ¶r? FÃ¶r att vi som utvecklare ofta behÃ¶ver validering, kontroll, och tydlighet samt hÃ¥lla data konsekvent.

Att gÃ¥ frÃ¥n dokument i Atlas till schema i Mongoose Ã¤r som att gÃ¥ frÃ¥n post-it-lappar till en pÃ¤rm med flikar.

Mongoose fungerar som ett lager mellan MongoDB och Node.js. Vi skapar modeller som kontrollerar hur dokument ska se ut.

Med ref kan vi bygga relationer som liknar JOINs â€“ t.ex. Post har en user. Det betyder att vi kan hÃ¤mta in hela anvÃ¤ndaren med .populate().

ğŸ—£ï¸ VarfÃ¶r anvÃ¤nda scheman?

FÃ¶rdelar	
FÃ¶rhindrar inkonsekvent data	

Ger validering och struktur	

Bra vid stÃ¶rre eller delade projekt	

Nackdelar
Mindre flexibel Ã¤n ren MongoDB

KrÃ¤ver extra kod och konfiguration

Inte alltid nÃ¶dvÃ¤ndigt i smÃ¥ appar

ğŸ—£ï¸ Hur fungerar ref och populate()?
ref anvÃ¤nds i ett schema fÃ¶r att skapa relationer till andra modeller

populate() anvÃ¤nds i kod fÃ¶r att automatiskt hÃ¤mta den relaterade datan frÃ¥n en annan samling

-----------------------------
-----------------------------
-----------------------------
ğŸ’» CODE-ALONG â€“ Mongoose Schema & Ref

Del 1: Projektsetup & Schema

ğŸ“ Projektstruktur:
 root mappen/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ User.js
â”‚   â””â”€â”€ Post.js
â”œâ”€â”€ index.js
â”œâ”€â”€ .env

Initiera projekt: npm init -y

Installera:
npm install express mongoose dotenv

Skapa models/User.js:
GenomfÃ¶r den koden.

Skapa models/Post.js:
GenomfÃ¶r den koden.

Skapa index.js, koppla till din Atlas-databas:
GenomfÃ¶r den koden.

-----------------------------
-----------------------------
-----------------------------
Dags fÃ¶r Ã¶vningar

-----------------------------
-----------------------------
-----------------------------
âœ… Verifiera att allt fungerar â€“ Testa i Postman

1. Skapa en anvÃ¤ndare

Method: POST

URL: http://localhost:3000/users

Body (JSON):
{
  "name": "Anna Andersson",
  "email": "anna@example.com"
}

ğŸ“Œ FÃ¶rvÃ¤ntat svar: Ett objekt med namn, e-post, och ett automatiskt genererat _id.

2. Skapa ett inlÃ¤gg som kopplas till anvÃ¤ndaren

Method: POST

URL: http://localhost:3000/posts

Body (JSON):
{
  "title": "Min fÃ¶rsta post",
  "content": "Detta Ã¤r mitt fÃ¶rsta inlÃ¤gg i databasen.",
  "user": "id:t frÃ¥n anvÃ¤ndaren ovan: Klistra in hÃ¤r!!!"
}

ğŸ“Œ Tips: Kopiera _id frÃ¥n svaret pÃ¥ steg 1 och klistra in det i "user"-fÃ¤ltet.

3. HÃ¤mta alla inlÃ¤gg â€“ verifiera att .populate() fungerar

Method: GET

URL: http://localhost:3000/posts

ğŸ“Œ FÃ¶rvÃ¤ntat svar: En array dÃ¤r varje post innehÃ¥ller:
{
  "title": "...",
  "content": "...",
  "user": {
    "_id": "...",
    "name": "Anna Andersson",
    "email": "anna@example.com"
  }
}

ğŸ§  FrÃ¥ga till klassen:

â€œVad hade vi fÃ¥tt om vi INTE anvÃ¤nt .populate()?â€

4. Testa sorterad route â€“ hÃ¤mta de 5 senaste posterna

Method: GET

URL: http://localhost:3000/posts/latest

ğŸ“Œ FÃ¶rvÃ¤ntat resultat: Max 5 poster, sorterade med senaste fÃ¶rst

5. HÃ¤mta "rensad" version â€“ endast fÃ¤lt vi vill visa i frontend

Method: GET

URL: http://localhost:3210/posts/clean

ğŸ“Œ FÃ¶rvÃ¤ntat resultat:
{
  "title": "...",
  "content": "...",
  "user": {
    "name": "Anna Andersson",
    "email": "anna@example.com"
  }
}

ğŸ§  Diskussion:
VarfÃ¶r Ã¤r det en fÃ¶rdel att inte skicka med onÃ¶diga fÃ¤lt som _id, __v och updatedAt?

ğŸ“ Avslutande kommentar:
Det hÃ¤r Ã¤r grunden till att bygga t.ex. bloggar, nyhetsflÃ¶den, kommentarsystem eller alla typer av appar dÃ¤r anvÃ¤ndare skapar innehÃ¥ll.
Med .populate() kan vi enkelt bygga relationer, och med .select() kan vi kontrollera exakt vad som syns i frontend.

-----------------------------
-----------------------------
-----------------------------
ğŸ” Gruppdiskussion 

Hur kÃ¤nns det att modellera i kod jÃ¤mfÃ¶rt med att klicka i Atlas GUI?

NÃ¤r tycker ni det Ã¤r bÃ¤st att anvÃ¤nda .populate() â€“ och nÃ¤r borde man hellre spara all data direkt i dokumentet?

Om ni skulle bygga en blogg eller ett kommentarsfÃ¤lt â€“ hur skulle ni modellera det nu?